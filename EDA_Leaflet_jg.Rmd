---
title: "EDA_NY_taxi"
author: "Team 7"
date: "December 3, 2016"
output:
  html_notebook: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readr)
library(dplyr)
library(leaflet)

rm(list=ls(all=TRUE))

```


```{r}
ride.counts <- read_csv("./data/count_table_total.csv")

```

## Trying a first map
```{r}
m <- leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addMarkers(lng=-73.84267, lat=40.86516, popup="New York") %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolylines(lng = c(-73.84267,-73.85), lat = c(40.86516, 40.85) )

m <- addPolylines(m, lng = c(-73.84267,-73.85), lat = c(40.86516, 40.86),
                  weight = 10)
m <- addPolylines(m, lng = c(-73.84267,-73.9), lat = c(40.86516, 40.86),
                  weight = 20)
m  # Print the map
```

Summarizing over the whole database
```{r}

ride.counts.all <- ride.counts %>% 
  dplyr::group_by(pickup_zone, dropoff_zone, pickup_lon, pickup_lat, dropoff_lon, dropoff_lat, color) %>%
  dplyr::summarise(total.count = sum(n)) %>% as.data.frame()

#ride.counts.all$total.count <- as.numeric(ride.counts.all$total.count)


ride.counts.filter.threshold <- dplyr::filter(ride.counts.all, total.count >= 30000)

ride.counts.filter.threshold[,8] <- as.integer(as.character(ride.counts.filter.threshold[,8]))

dim(ride.counts.filter.threshold)
```


```{r}
source("./lib/functions.R")
```


```{r, fig.width=10}
n <- leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addProviderTiles("CartoDB.Positron")

n <- paint.arrows(n, ride.counts.filter.threshold)

n  # Print the map
```

